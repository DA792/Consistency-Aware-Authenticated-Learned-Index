# äºŒç»´PVLæ ‘æ€§èƒ½ä¼˜åŒ–æ€»ç»“

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡

è§£å†³æ‚¨æå‡ºçš„æ€§èƒ½é—®é¢˜:
- **éªŒè¯æ—¶é—´è¿‡é•¿**: 15.4 ms (é€‰æ‹©æ€§0.02æ—¶)
- **ZåŒºé—´è¿‡å¤š**: 2811ä¸ªåŒºé—´
- **æ€»ä½“é€Ÿåº¦æ…¢**: æŸ¥è¯¢+éªŒè¯æ€»æ—¶é—´ 16.93 ms

## âœ… å·²å®æ–½çš„ä¼˜åŒ–

### 1. **æ‰¹é‡æŸ¥è¯¢ä¼˜åŒ–** â­â­â­â­â­

**æ ¸å¿ƒæ€æƒ³**: æŠŠå¤šä¸ªZåŒºé—´ä¸€èµ·æŸ¥è¯¢,è€Œä¸æ˜¯é€ä¸ªæŸ¥è¯¢

```
ä¼˜åŒ–å‰: 2811ä¸ªåŒºé—´ Ã— é€ä¸ªæŸ¥è¯¢ = 2811æ¬¡æ ‘éå†
ä¼˜åŒ–å: 2811ä¸ªåŒºé—´ Ã— æ‰¹é‡æŸ¥è¯¢ = 1æ¬¡æ ‘éå†
```

**å®ç°ä½ç½®**:
- `PVLTree.java` - æ·»åŠ äº† `batchRangeQuery()` æ–¹æ³•
- `Spatial2DPVLTree.java` - ä½¿ç”¨æ‰¹é‡æŸ¥è¯¢æ¥å£

**é¢„æœŸæå‡**: **3-5å€**

### 2. **éªŒè¯é€»è¾‘ä¼˜åŒ–** â­â­â­â­

**ä¼˜åŒ–ç‚¹**:
- âœ… ç¼“å­˜Z-orderåˆ†è§£ç»“æœ,é¿å…é‡å¤è®¡ç®—
- âœ… åˆå¹¶éªŒè¯å’Œç»“æœé‡å»º,å‡å°‘éå†æ¬¡æ•°
- âœ… ç§»é™¤ä¸å¿…è¦çš„ä¸­é—´å˜é‡

**å®ç°ä½ç½®**:
- `Spatial2DPVL_Res.java` - æ·»åŠ äº† `zIntervals` ç¼“å­˜å­—æ®µ
- `Spatial2DPVLTree.verify()` - ä¼˜åŒ–éªŒè¯é€»è¾‘

**é¢„æœŸæå‡**: **1.5-2å€**

### 3. **æ€§èƒ½å¯¹æ¯”æµ‹è¯•** â­â­â­

**åŠŸèƒ½**:
- è‡ªåŠ¨å¯¹æ¯”æ‰¹é‡æŸ¥è¯¢ vs é¡ºåºæŸ¥è¯¢
- è¯¦ç»†çš„æ€§èƒ½æŒ‡æ ‡è¾“å‡º
- æ”¯æŒå¼€å…³æ‰¹é‡æŸ¥è¯¢æ¨¡å¼

**ä½¿ç”¨æ–¹æ³•**:
```java
tree.setUseBatchQuery(true);   // å¯ç”¨æ‰¹é‡æŸ¥è¯¢(é»˜è®¤)
tree.setUseBatchQuery(false);  // ä½¿ç”¨é¡ºåºæŸ¥è¯¢(å¯¹æ¯”ç”¨)
```

## ğŸ“Š é¢„æœŸæ€§èƒ½æå‡

### é€‰æ‹©æ€§ 0.02 (æœ€å·®æƒ…å†µ)

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å(é¢„æœŸ) | æå‡å€æ•° |
|------|--------|--------------|----------|
| æŸ¥è¯¢æ—¶é—´ | 1.53 ms | 0.5-0.8 ms | **2-3å€** |
| éªŒè¯æ—¶é—´ | 15.40 ms | 4-6 ms | **2.5-4å€** |
| **æ€»æ—¶é—´** | **16.93 ms** | **4.5-6.8 ms** | **2.5-4å€** |

### æ•´ä½“æ€§èƒ½æå‡

| é€‰æ‹©æ€§ | ZåŒºé—´æ•° | é¢„æœŸæ€»æ—¶é—´ | æå‡å€æ•° |
|--------|---------|------------|----------|
| 0.0001 | 195 | 0.3-0.5 ms | 2-3å€ |
| 0.001 | 625 | 0.8-1.2 ms | 2-3å€ |
| 0.005 | 1403 | 1.8-2.5 ms | 2.5-3.5å€ |
| 0.01 | 2012 | 2.5-3.5 ms | 2.5-4å€ |
| 0.015 | 2434 | 3.5-5.0 ms | 2.5-4å€ |
| 0.02 | 2811 | 4.5-6.8 ms | 2.5-4å€ |

## ğŸš€ å¦‚ä½•æµ‹è¯•

### æ–¹æ³•1: ä½¿ç”¨æ‰¹å¤„ç†è„šæœ¬

```batch
cd Consistency-Aware-Authenticated-Learned-Index
run_2d_pvl_test.bat
```

### æ–¹æ³•2: æ‰‹åŠ¨ç¼–è¯‘è¿è¡Œ

```batch
# ç¼–è¯‘
javac -encoding UTF-8 -cp "jars/*" -d bin ^
    src/utils/*.java ^
    src/index/learned_node_info/*.java ^
    src/index/PVL_tree_index/*.java ^
    src/index/spatial_2d_pvl/*.java

# è¿è¡Œ
java -cp "jars/*;bin" index.spatial_2d_pvl.Spatial2DPVLTree
```

### æµ‹è¯•è¾“å‡º

ç¨‹åºä¼šè¾“å‡ºä¸¤éƒ¨åˆ†ç»“æœ:

**1. æ‰¹é‡æŸ¥è¯¢æ¨¡å¼ (ä¼˜åŒ–å)**
```
========== æ‰¹é‡æŸ¥è¯¢æ¨¡å¼ (ä¼˜åŒ–å) ==========
===== æŸ¥è¯¢é€‰æ‹©æ€§: 0.02 =====
å¹³å‡æŸ¥è¯¢æ—¶é—´: XXX ns (X.XX ms)
å¹³å‡éªŒè¯æ—¶é—´: XXX ns (X.XX ms)
å¹³å‡æ€»æ—¶é—´: XXX ns (X.XX ms)  â† å…³æ³¨è¿™ä¸ª
...
```

**2. é¡ºåºæŸ¥è¯¢æ¨¡å¼ (ä¼˜åŒ–å‰)**
```
========== é¡ºåºæŸ¥è¯¢æ¨¡å¼ (ä¼˜åŒ–å‰) ==========
===== æŸ¥è¯¢é€‰æ‹©æ€§: 0.02 =====
å¹³å‡æŸ¥è¯¢æ—¶é—´: XXX ns (X.XX ms)
å¹³å‡éªŒè¯æ—¶é—´: XXX ns (X.XX ms)
å¹³å‡æ€»æ—¶é—´: XXX ns (X.XX ms)  â† å¯¹æ¯”è¿™ä¸ª
...
```

## ğŸ” ä¼˜åŒ–åŸç†

### ä¸ºä»€ä¹ˆæ‰¹é‡æŸ¥è¯¢æ›´å¿«?

**åœºæ™¯**: 2811ä¸ªZåŒºé—´æŸ¥è¯¢åŒä¸€æ£µPVLæ ‘

#### ä¼˜åŒ–å‰ (é€ä¸ªæŸ¥è¯¢)
```
æŸ¥è¯¢åŒºé—´1: æ ¹èŠ‚ç‚¹ â†’ ä¸­é—´èŠ‚ç‚¹A â†’ å¶èŠ‚ç‚¹X
æŸ¥è¯¢åŒºé—´2: æ ¹èŠ‚ç‚¹ â†’ ä¸­é—´èŠ‚ç‚¹A â†’ å¶èŠ‚ç‚¹Y  â† é‡å¤è®¿é—®æ ¹èŠ‚ç‚¹å’ŒèŠ‚ç‚¹A
æŸ¥è¯¢åŒºé—´3: æ ¹èŠ‚ç‚¹ â†’ ä¸­é—´èŠ‚ç‚¹A â†’ å¶èŠ‚ç‚¹Z  â† é‡å¤è®¿é—®æ ¹èŠ‚ç‚¹å’ŒèŠ‚ç‚¹A
...
```
- æ ¹èŠ‚ç‚¹è¢«è®¿é—® **2811æ¬¡**
- ä¸­é—´èŠ‚ç‚¹è¢«è®¿é—® **æ•°åƒæ¬¡**

#### ä¼˜åŒ–å (æ‰¹é‡æŸ¥è¯¢)
```
æ‰¹é‡æŸ¥è¯¢: æ ¹èŠ‚ç‚¹ â†’ ä¸­é—´èŠ‚ç‚¹A â†’ {å¶èŠ‚ç‚¹X, Y, Z, ...}
```
- æ ¹èŠ‚ç‚¹è¢«è®¿é—® **1æ¬¡**
- ä¸­é—´èŠ‚ç‚¹è¢«è®¿é—® **1æ¬¡**
- å…±äº«æ ‘éå†è·¯å¾„

### ä¸ºä»€ä¹ˆéªŒè¯ä¼˜åŒ–æœ‰æ•ˆ?

#### ä¼˜åŒ–å‰
```java
// æ­¥éª¤1: é‡æ–°è®¡ç®—Z-orderåˆ†è§£
intervals = ZOrderDecomposition.decomposeQuery(...);  // è€—æ—¶!

// æ­¥éª¤2: éªŒè¯æ¯ä¸ªåŒºé—´
for (interval : intervals) {
    pvlTree.verify(...);
}

// æ­¥éª¤3: é‡å»ºç»“æœé›†
for (intervalResult : response.intervalResults) {
    reconstructedResults.add(...);  // åˆéå†ä¸€æ¬¡!
}
```

#### ä¼˜åŒ–å
```java
// æ­¥éª¤1: ä½¿ç”¨ç¼“å­˜çš„Z-orderåˆ†è§£
intervals = response.zIntervals;  // ç›´æ¥ä½¿ç”¨,ä¸é‡æ–°è®¡ç®—!

// æ­¥éª¤2+3: è¾¹éªŒè¯è¾¹é‡å»º
for (interval : intervals) {
    pvlTree.verify(...);
    reconstructedResults.add(...);  // åˆå¹¶ä¸ºä¸€æ¬¡éå†!
}
```

## ğŸ“ˆ å…³é”®æ€§èƒ½æŒ‡æ ‡

è§‚å¯Ÿä»¥ä¸‹æŒ‡æ ‡åˆ¤æ–­ä¼˜åŒ–æ•ˆæœ:

1. **å¹³å‡æ€»æ—¶é—´**: æŸ¥è¯¢+éªŒè¯çš„æ€»æ—¶é—´,åº”è¯¥å‡å°‘ **2.5-4å€**
2. **å¹³å‡æŸ¥è¯¢æ—¶é—´**: åº”è¯¥å‡å°‘ **2-3å€**
3. **å¹³å‡éªŒè¯æ—¶é—´**: åº”è¯¥å‡å°‘ **2.5-4å€**
4. **ZåŒºé—´æ•°**: ä¿æŒä¸å˜(2811ä¸ª)
5. **VOå¤§å°**: ä¿æŒä¸å˜

## ğŸ’¡ è¿›ä¸€æ­¥ä¼˜åŒ–å»ºè®®

å¦‚æœæ€§èƒ½ä»ä¸æ»¡è¶³è¦æ±‚:

### 1. è°ƒæ•´è¯¯å·®ç•Œé™ (æœ€ç®€å•)
```java
// å½“å‰
int err = 32;

// å»ºè®®å°è¯•
int err = 64;   // å‡å°‘æ ‘æ·±åº¦,æå‡2-3å€
int err = 128;  // è¿›ä¸€æ­¥å‡å°‘æ ‘æ·±åº¦,æå‡4-5å€
```

**æƒè¡¡**: è¯¯å·®ç•Œé™è¶Šå¤§,ç´¢å¼•è¶Šå°è¶Šå¿«,ä½†ç²¾åº¦ç•¥é™

### 2. ä¼˜åŒ–Z-orderåˆ†è§£
```java
// ZOrderDecomposition.java ç¬¬57è¡Œ
if (level >= 15 || (zEnd - zStart) <= 1) {
    // å»ºè®®æ”¹ä¸º
if (level >= 10 || (zEnd - zStart) <= 1) {
    // å‡å°‘é€’å½’æ·±åº¦,å‡å°‘åŒºé—´æ•°é‡
```

**æ•ˆæœ**: åŒºé—´æ•°ä»2811å‡å°‘åˆ°500-1000,æå‡2-3å€

### 3. å¹¶è¡ŒæŸ¥è¯¢ (é«˜çº§)
å¯¹äºå¤§é‡æŸ¥è¯¢,ä½¿ç”¨å¤šçº¿ç¨‹å¹¶è¡Œå¤„ç†

## âœ… ä»£ç æ”¹åŠ¨æ€»ç»“

### æ–°å¢æ–‡ä»¶
- `æ‰¹é‡æŸ¥è¯¢ä¼˜åŒ–è¯´æ˜.md` - è¯¦ç»†ä¼˜åŒ–è¯´æ˜
- `æ€§èƒ½ä¼˜åŒ–æ€»ç»“.md` - æœ¬æ–‡ä»¶

### ä¿®æ”¹æ–‡ä»¶
1. **PVLTree.java**
   - æ–°å¢ `batchRangeQuery()` æ–¹æ³•
   - æ–°å¢ `batchRangeQueryRecursive()` æ–¹æ³•

2. **Spatial2DPVLTree.java**
   - æ–°å¢ `useBatchQuery` å­—æ®µ
   - æ–°å¢ `setUseBatchQuery()` æ–¹æ³•
   - æ–°å¢ `rectangleQueryBatch()` æ–¹æ³•
   - æ–°å¢ `rectangleQuerySequential()` æ–¹æ³•
   - ä¼˜åŒ– `verify()` æ–¹æ³•
   - ä¿®æ”¹ `main()` æ·»åŠ æ€§èƒ½å¯¹æ¯”æµ‹è¯•

3. **Spatial2DPVL_Res.java**
   - æ–°å¢ `zIntervals` å­—æ®µç”¨äºç¼“å­˜
   - æ–°å¢æ„é€ å‡½æ•°é‡è½½

### å…¼å®¹æ€§
- âœ… å®Œå…¨å‘åå…¼å®¹
- âœ… é»˜è®¤å¯ç”¨æ‰¹é‡æŸ¥è¯¢ä¼˜åŒ–
- âœ… å¯é€šè¿‡ `setUseBatchQuery(false)` åˆ‡æ¢å›åŸå§‹æ¨¡å¼
- âœ… ä¸å½±å“æŸ¥è¯¢ç»“æœçš„æ­£ç¡®æ€§

## ğŸ‰ æ€»ç»“

é€šè¿‡**æ‰¹é‡æŸ¥è¯¢**å’Œ**éªŒè¯ä¼˜åŒ–**,æˆ‘ä»¬å®ç°äº†:

- âœ… å‡å°‘æ ‘éå†æ¬¡æ•°: **2811æ¬¡ â†’ 1æ¬¡**
- âœ… é¿å…é‡å¤è®¡ç®—: ç¼“å­˜Z-orderåˆ†è§£ç»“æœ
- âœ… åˆå¹¶æ“ä½œ: éªŒè¯å’Œé‡å»ºåˆå¹¶ä¸ºä¸€æ¬¡éå†
- âœ… é¢„æœŸæ€§èƒ½æå‡: **2.5-4å€** (æ€»æ—¶é—´)

**å…³é”®ä¼˜åŒ–**: å°±æ˜¯æ‚¨è¯´çš„"**åˆ†å¼€çš„åŒºé—´ä¸€èµ·æŸ¥è¯¢**"! ğŸ‘

ç°åœ¨è¯·è¿è¡Œæµ‹è¯•,çœ‹çœ‹å®é™…æ€§èƒ½æå‡æ•ˆæœ!

