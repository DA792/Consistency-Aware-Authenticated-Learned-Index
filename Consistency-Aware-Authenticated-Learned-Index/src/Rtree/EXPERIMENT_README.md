# R-tree uniform_500k.csv 数据集实验

本文档描述了针对 `uniform_500k.csv` 数据集的 R-tree 实验设计和使用方法。

## 数据集信息

- **文件**: `src/data/uniform_500k.csv`
- **数据量**: 500,000 个二维点
- **格式**: CSV格式，包含 x,y 坐标
- **数据类型**: 均匀分布的随机点
- **坐标范围**: 大约 0-500,000

## 实验程序

### 1. RTreeQuickTest.java - 快速测试
**用途**: 使用10,000个点进行快速功能验证
**运行时间**: 约10-30秒
**运行方法**: 
```batch
run_rtree_quick_test.bat
```

**测试内容**:
- 数据加载和分析
- R-tree构建性能
- 不同选择率的范围查询
- 点查询测试
- 基本性能统计

### 2. RTreeExperiment.java - 完整实验
**用途**: 使用完整的500,000个点进行全面性能测试
**运行时间**: 约5-15分钟
**运行方法**:
```batch
run_rtree_experiment.bat
```

**测试内容**:
1. **数据集分析**
   - 数据加载时间
   - 数据分布分析
   - 坐标范围统计

2. **R-tree构建**
   - 批量插入性能
   - 构建进度显示
   - 每个点的平均插入时间

3. **树结构分析**
   - 树高度和节点数
   - 叶子节点填充率
   - 内存使用估算

4. **查询性能测试**
   - 1000次范围查询测试
   - 平均查询时间统计
   - 节点访问效率分析

5. **选择率测试**
   - 0.01%, 0.1%, 1%, 10% 选择率
   - 不同选择率下的性能对比
   - 查询时间与结果数量的关系

6. **内存使用分析**
   - JVM内存使用情况
   - R-tree内存占用估算
   - 每个点的平均内存开销

## 预期实验结果

### 构建性能
- **插入时间**: 约1-3秒 (2-6 μs/点)
- **树高度**: 约4-6层
- **节点数**: 约5,000-15,000个节点
- **内存使用**: 约50-100MB

### 查询性能
| 选择率 | 平均查询时间 | 平均结果数量 | 访问节点比例 |
|--------|-------------|-------------|-------------|
| 0.01%  | 5-15 μs     | ~50 点      | ~0.5-1%     |
| 0.1%   | 10-30 μs    | ~500 点     | ~1-3%       |
| 1%     | 50-150 μs   | ~5,000 点   | ~5-10%      |
| 10%    | 200-500 μs  | ~50,000 点  | ~20-40%     |

### 性能特点
- **查询时间**: 随选择率对数增长
- **节点访问**: 高效的空间剪枝
- **内存效率**: 每个点约100-200字节
- **扩展性**: 支持百万级数据

## 实验环境要求

### 硬件要求
- **内存**: 至少4GB可用内存
- **CPU**: 现代多核处理器
- **存储**: 至少100MB可用空间

### 软件要求
- **Java**: JDK 8或更高版本
- **JVM参数**: 建议使用 `-Xms2g -Xmx4g`

## 性能优化建议

### JVM优化
```batch
set JVM_OPTS=-Xms2g -Xmx4g -XX:+UseG1GC -XX:+PrintGCDetails
```

### 数据预处理
- 数据已经是随机分布，无需额外预处理
- 可以考虑按Z-order排序来提高构建效率

### 查询优化
- 使用合适的查询矩形大小
- 避免过大的选择率查询
- 批量查询时可以重用查询结果对象

## 实验数据分析

### 构建阶段分析
1. **插入性能曲线**: 随着数据量增加，插入时间可能略有增长
2. **树结构演化**: 观察树高度和节点分裂情况
3. **内存使用模式**: 分析内存增长趋势

### 查询阶段分析
1. **选择率-性能关系**: 验证对数时间复杂度
2. **空间局部性**: 分析查询区域对性能的影响
3. **缓存效应**: 重复查询的性能提升

### 对比分析
- 与线性扫描的性能对比
- 与其他空间索引的理论对比
- 不同参数设置的影响分析

## 故障排除

### 常见问题
1. **内存不足**: 增加JVM堆内存大小
2. **编译错误**: 检查Java版本和类路径
3. **数据文件找不到**: 确认CSV文件路径正确

### 性能问题
1. **构建太慢**: 检查内存设置和GC策略
2. **查询太慢**: 验证查询矩形大小是否合理
3. **内存泄漏**: 使用内存分析工具检查

## 扩展实验

### 参数调优
- 修改节点最大/最小容量
- 尝试不同的分裂策略
- 调整内存分配策略

### 数据集变化
- 使用不同分布的数据集
- 测试不同数据量的扩展性
- 分析数据倾斜的影响

### 功能扩展
- 添加删除操作测试
- 实现最近邻查询
- 支持动态更新场景
