# Z åŒºé—´æ•°é‡ä¼˜åŒ–

## âœ… å·²å®Œæˆçš„ä¿®æ”¹

### ä¿®æ”¹æ–‡ä»¶
`src/utils/ZOrderDecomposition.java` ç¬¬ 57-58 è¡Œ

### ä¿®æ”¹å†…å®¹

```java
// ä¼˜åŒ–å‰
if (level >= 15 || (zEnd - zStart) <= 1) {
    intervals.add(new ZInterval(zStart, zEnd, zRegion));
    return;
}

// ä¼˜åŒ–å
if (level >= 10 || (zEnd - zStart) <= 1) {
    intervals.add(new ZInterval(zStart, zEnd, zRegion));
    return;
}
```

## ğŸ¯ ä¼˜åŒ–åŸç†

### Z-order åˆ†è§£é€’å½’æ·±åº¦

```
é€’å½’æ·±åº¦è¶Šå¤§ â†’ åŒºé—´åˆ†è§£è¶Šç»† â†’ ZåŒºé—´æ•°è¶Šå¤š â†’ æŸ¥è¯¢æ¬¡æ•°è¶Šå¤š

level >= 15 (ä¼˜åŒ–å‰):
  - æœ€å¤šé€’å½’ 15 å±‚
  - äº§ç”Ÿå¤§é‡å°åŒºé—´
  - é€‰æ‹©æ€§ 0.02 æ—¶: 2811 ä¸ªåŒºé—´

level >= 10 (ä¼˜åŒ–å):
  - æœ€å¤šé€’å½’ 10 å±‚
  - äº§ç”Ÿè¾ƒå°‘çš„è¾ƒå¤§åŒºé—´
  - é¢„æœŸ: 500-1000 ä¸ªåŒºé—´
```

## ğŸ“Š é¢„æœŸæ•ˆæœ

### Z åŒºé—´æ•°é‡å˜åŒ–

| é€‰æ‹©æ€§ | ä¼˜åŒ–å‰ (levelâ‰¥15) | ä¼˜åŒ–å (levelâ‰¥10) | å‡å°‘ |
|--------|------------------|------------------|------|
| 0.0001 | 195 | ~50-80 | 60-70% |
| 0.001 | 625 | ~150-250 | 60-75% |
| 0.005 | 1403 | ~350-500 | 65-75% |
| 0.01 | 2012 | ~500-700 | 65-75% |
| 0.015 | 2434 | ~600-850 | 65-75% |
| 0.02 | 2811 | ~700-1000 | 65-75% |

### æ€§èƒ½æå‡é¢„æœŸ

| é€‰æ‹©æ€§ | ä¼˜åŒ–å‰æ€»æ—¶é—´ | ä¼˜åŒ–åé¢„æœŸ | æå‡ |
|--------|------------|-----------|------|
| 0.001 | 2.73 ms | ~1.0 ms | 2.7å€ |
| 0.01 | 11.18 ms | ~4.0 ms | 2.8å€ |
| 0.02 | 11.66 ms | ~4.2 ms | 2.8å€ |

## âš ï¸ å¯èƒ½çš„å‰¯ä½œç”¨

### 1. å‡é˜³æ€§ç‡å¯èƒ½å¢åŠ 

```
åŒºé—´å˜å¤§ â†’ åŒ…å«æ›´å¤šä¸ç›¸å…³çš„ç‚¹ â†’ éœ€è¦è¿‡æ»¤æ›´å¤šå€™é€‰ç‚¹
```

**å½±å“**: 
- å‡é˜³æ€§ç‡å¯èƒ½ä» 0% å¢åŠ åˆ° 5-10%
- ä½†ç”±äºæŸ¥è¯¢æ¬¡æ•°å¤§å¹…å‡å°‘,æ€»ä½“ä»ç„¶æ›´å¿«

### 2. VO å¤§å°å¯èƒ½ç•¥å¾®å¢åŠ 

```
æ¯ä¸ªåŒºé—´æ›´å¤§ â†’ å•ä¸ªåŒºé—´çš„ VO å¯èƒ½æ›´å¤§
ä½†åŒºé—´æ€»æ•°å‡å°‘ â†’ æ€» VO å¤§å°å¯èƒ½å‡å°‘
```

**å½±å“**:
- å•ä¸ªæŸ¥è¯¢çš„ VO: å¯èƒ½å¢åŠ  10-20%
- æ€» VO å¤§å°: å¯èƒ½å‡å°‘ 30-50%

### 3. æŸ¥è¯¢ç²¾åº¦ç•¥å¾®ä¸‹é™

```
åŒºé—´ç²’åº¦å˜ç²— â†’ è¾¹ç•Œå¤„ç†ä¸å¤Ÿç²¾ç»†
```

**å½±å“**:
- å¯¹å¤§å¤šæ•°æŸ¥è¯¢å½±å“å¾ˆå°
- è¾¹ç•Œæƒ…å†µå¯èƒ½éœ€è¦æ£€æŸ¥æ›´å¤šç‚¹

## ğŸ”§ å¦‚ä½•æµ‹è¯•

### è¿è¡Œæµ‹è¯•è„šæœ¬

```batch
test_z_optimization.bat
```

### è§‚å¯Ÿå…³é”®æŒ‡æ ‡

1. **Z åŒºé—´æ•°**: åº”è¯¥ä» 2811 é™åˆ° 700-1000
2. **æ€»æ—¶é—´**: åº”è¯¥ä» 11.66 ms é™åˆ° 4-5 ms
3. **å‡é˜³æ€§ç‡**: è§‚å¯Ÿæ˜¯å¦åœ¨å¯æ¥å—èŒƒå›´
4. **VO å¤§å°**: è§‚å¯Ÿæ€» VO å¤§å°å˜åŒ–

## ğŸ“ˆ ä¸å…¶ä»–ä¼˜åŒ–ç»„åˆ

### ç»„åˆä¼˜åŒ– 1: ZåŒºé—´ä¼˜åŒ– + å¢å¤§è¯¯å·®ç•Œé™

```java
// ZOrderDecomposition.java
if (level >= 10 || (zEnd - zStart) <= 1) {  // âœ… å·²ä¿®æ”¹

// Spatial2DPVLTree.java
int err = 64;  // ä» 32 æ”¹ä¸º 64
```

**é¢„æœŸæ•ˆæœ**:
- Z åŒºé—´æ•°: 2811 â†’ 700-1000 (å‡å°‘ 65%)
- å•æ¬¡æŸ¥è¯¢: æ›´å¿« (æ ‘æ›´å°)
- **æ€»æå‡: 4-6 å€**

### ç»„åˆä¼˜åŒ– 2: æ¿€è¿›ä¼˜åŒ–

```java
// ZOrderDecomposition.java
if (level >= 8 || (zEnd - zStart) <= 1) {  // æ›´æ¿€è¿›: é™åˆ° 8

// Spatial2DPVLTree.java
int err = 128;  // æ›´å¤§çš„è¯¯å·®ç•Œé™
```

**é¢„æœŸæ•ˆæœ**:
- Z åŒºé—´æ•°: 2811 â†’ 300-500 (å‡å°‘ 80%)
- å•æ¬¡æŸ¥è¯¢: éå¸¸å¿«
- **æ€»æå‡: 8-12 å€**

**æ³¨æ„**: å‡é˜³æ€§ç‡å¯èƒ½å¢åŠ åˆ° 10-20%

## ğŸ¯ æ¨èé…ç½®

### é…ç½® 1: ä¿å®ˆä¼˜åŒ– (æ¨è)

```java
// ZOrderDecomposition.java
if (level >= 10 || (zEnd - zStart) <= 1) {  // âœ… å½“å‰é…ç½®

// Spatial2DPVLTree.java
int err = 32;  // ä¿æŒä¸å˜
```

- æ€§èƒ½æå‡: 2-3 å€
- å‰¯ä½œç”¨: å¾ˆå°
- **é€‚åˆå¤§å¤šæ•°åœºæ™¯**

### é…ç½® 2: å¹³è¡¡ä¼˜åŒ–

```java
// ZOrderDecomposition.java
if (level >= 10 || (zEnd - zStart) <= 1) {  // âœ… å½“å‰é…ç½®

// Spatial2DPVLTree.java
int err = 64;  // å¢å¤§è¯¯å·®ç•Œé™
```

- æ€§èƒ½æå‡: 4-6 å€
- å‰¯ä½œç”¨: ä¸­ç­‰
- **æ¨èç”¨äºæ€§èƒ½è¦æ±‚é«˜çš„åœºæ™¯**

### é…ç½® 3: æ¿€è¿›ä¼˜åŒ–

```java
// ZOrderDecomposition.java
if (level >= 8 || (zEnd - zStart) <= 1) {  // æ”¹ä¸º 8

// Spatial2DPVLTree.java
int err = 128;  // å¤§å¹…å¢å¤§è¯¯å·®ç•Œé™
```

- æ€§èƒ½æå‡: 8-12 å€
- å‰¯ä½œç”¨: è¾ƒå¤§
- **ä»…ç”¨äºå¯¹æ€§èƒ½è¦æ±‚æé«˜çš„åœºæ™¯**

## ğŸ“ æµ‹è¯•ç»“æœè®°å½•

### ä¼˜åŒ–å‰ (level >= 15, err = 32)

```
é€‰æ‹©æ€§ 0.02:
- æŸ¥è¯¢æ—¶é—´: 1.13 ms
- éªŒè¯æ—¶é—´: 10.53 ms
- æ€»æ—¶é—´: 11.66 ms
- ZåŒºé—´æ•°: 2811
- VOå¤§å°: 1798.85 KB
```

### ä¼˜åŒ–å (level >= 10, err = 32)

è¿è¡Œ `test_z_optimization.bat` æŸ¥çœ‹å®é™…ç»“æœ:

```
é€‰æ‹©æ€§ 0.02:
- æŸ¥è¯¢æ—¶é—´: ___ ms
- éªŒè¯æ—¶é—´: ___ ms
- æ€»æ—¶é—´: ___ ms
- ZåŒºé—´æ•°: ___
- VOå¤§å°: ___ KB
```

## ğŸš€ ä¸‹ä¸€æ­¥

1. **è¿è¡Œæµ‹è¯•**: `test_z_optimization.bat`
2. **æŸ¥çœ‹ç»“æœ**: å¯¹æ¯” Z åŒºé—´æ•°å’Œæ€»æ—¶é—´
3. **è¯„ä¼°æ•ˆæœ**: å¦‚æœæ»¡æ„,ä¿æŒå½“å‰é…ç½®
4. **è¿›ä¸€æ­¥ä¼˜åŒ–**: å¦‚æœè¿˜éœ€è¦æ›´å¿«,å¯ä»¥:
   - å¢å¤§è¯¯å·®ç•Œé™ (err = 64 æˆ– 128)
   - è¿›ä¸€æ­¥é™ä½é€’å½’æ·±åº¦ (level >= 8)

## ğŸ’¡ æ€»ç»“

### å…³é”®æ”¹åŠ¨

```java
// ä¸€è¡Œä»£ç çš„æ”¹åŠ¨
if (level >= 10 || (zEnd - zStart) <= 1) {  // ä» 15 æ”¹ä¸º 10
```

### é¢„æœŸæ•ˆæœ

- âœ… Z åŒºé—´æ•°å‡å°‘ 65-75%
- âœ… æŸ¥è¯¢æ¬¡æ•°å¤§å¹…å‡å°‘
- âœ… æ€»æ—¶é—´æå‡ 2-3 å€
- âš ï¸ å‡é˜³æ€§ç‡å¯èƒ½ç•¥å¾®å¢åŠ 

### é€‚ç”¨åœºæ™¯

- âœ… æ‰€æœ‰éœ€è¦æå‡æ€§èƒ½çš„åœºæ™¯
- âœ… å¯ä»¥æ¥å—å°‘é‡å‡é˜³æ€§çš„åœºæ™¯
- âœ… æŸ¥è¯¢é€‰æ‹©æ€§è¾ƒå¤§çš„åœºæ™¯ (0.01-0.05)

ç°åœ¨è¿è¡Œæµ‹è¯•,çœ‹çœ‹å®é™…æ•ˆæœå§! ğŸ‰

